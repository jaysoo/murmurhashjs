var fs = require('fs')
  , sys = require('sys')
  , assert = require('assert')
  , murmurhash = require('./murmurhash');

var hash = murmurhash.MurmurHash('foobar'); // note no seed

var hasher = murmurhash.createMurmurHasher(); // note no seed
hasher.add("foo");
hasher.add("bar");
var chash = hasher.end();

assert.equal(hash, chash);

var hash = murmurhash.MurmurHash('foobar', 42); // with a seed

var hasher = murmurhash.createMurmurHasher(42); // with a seed
hasher.add("foo");
hasher.add("bar");
var chash = hasher.end();

assert.equal(hash, chash);

// Some arbitrary checks
var hashes = [
3961514296, 509135771, 2190531934, 1375918805, 4079671217,
1404761069, 765689561, 324546703, 3790437364, 933627864,
1665579964, 3742079087, 2261358894, 2416676905, 2172749523,
1409867962, 2662290472, 141411744, 2329136405, 3813494447,
2178573556, 4080091298, 633210065, 2418125696, 2787922623,
2490079068, 702246653, 752100729, 2415588423, 100498054,
1549811389, 1473066399, 100670666, 1687068102, 4250928617,
4210043596, 739709049, 3901437622, 1360075933, 1150774379,
2474071149, 21849643, 2994069353, 3781501844, 933312658,
4068954388, 305479403, 3717735166, 263799328, 1778706776,
154691333, 1876622591, 802546543, 122629148, 3428449119,
3767962803, 939629629, 1772152179, 3273415885, 259141065,
1759712403, 3535331160, 1169186386, 166231832, 4032898169,
609176713, 4216495534, 818032660, 3395284260, 1946704703,
2230620866, 2923940235, 1149494267, 3840674120, 249484039,
3021018852, 2877369211, 3355432898, 3331229006, 310881491,
2355359457, 1184712210, 3337524798, 1635135489, 3406907341,
859473087, 1997127526, 3677546484, 3285036774, 3065907007,
970685356, 1974591336, 1232698218, 3999109061, 2116004911,
1670102749, 2316366771, 2109770622, 173940177, 1365156839,
461005607, 1285422570, 2779076616, 301491895, 2307642290,
1379776384, 1784479372, 1610302972, 3876478746, 4267203287,
425221774, 3053775399, 560301439, 2370761092, 3893335290,
1619886002, 837092257, 2339066995, 2799073492, 2593493735,
2333776645, 1197099694, 2878529875, 3908043538, 1591474625,
1747985658, 289204936, 2734814081, 3134651130, 1251016445,
1807645217, 1588174495, 3372088415, 3574811640, 1638257226,
2924099825, 2477013559, 2075061533, 3482827042, 2149534558,
4269627058, 3846165949, 3831014016, 1888254144, 2848453437,
3582681129, 1985581973, 2910249667, 3147041443, 635249871,
3573768980, 3393551432, 90142850, 77442383, 3086854865,
3895412580, 3904446907, 1571482811, 3537353051, 3790758634,
293963436, 1991819553, 2225274494, 693315964, 2283765886,
2784643154, 4169230233, 2677669548, 2399153107, 3084059202,
3646397633, 3218077558, 2452616365, 2650256882, 3515003031,
3984695915, 3322606026, 3036902147, 1581274830, 2038613296
];

var s = '';
var lastval = 0;
var n=0;
for(i=0;i<1024;i=i+1+(lastval%10)){
    var hasher = murmurhash.createMurmurHasher();
    s += '0';
    hasher.add(s);
    lastval = hasher.end();
    assert.equal(lastval, hashes[n]);
    n++;
}

var hasher = murmurhash.createMurmurHasher();
hasher.add('test');
assert.equal(hasher.end(), 1026673864);

fs.readFile('wscript', 'binary', function(err, data){
    var hasher = murmurhash.createMurmurHasher(); 
    hasher.add(data);
    assert.equal(hasher.end(), 3371330333);
});

assert.equal(murmurhash.MurmurHash(123, 0), 1074609160);

// Calling hasher end results in the hasher being 'reset' so adding 
assert.throws(function(){
    var hasher = murmurhash.createMurmurHasher();
    hasher.add('test');
    assert.equal(hasher.end(), 1026673864);
    assert.equal(hasher.end(), 0)
    hasher.add('whatever');
}, Error, "Hasher has already ended");

sys.puts('All tests passed.'); // Needs more tests though...
